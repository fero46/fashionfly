#= require jquery

<% environment.context_class.instance_eval { include Rails.application.routes.url_helpers;include ActionView::Helpers::OutputSafetyHelper
 } %>

$j = jQuery.noConflict();
$j(document).ready ($) ->
  prefix = "http://"

  if window.fashion_fly_is_inside == true
    return
  window.fashion_fly_is_inside = true
  $j('.fashionfly-widget').each (index, value) ->
    host = $j(value).attr('host')
    data_id = $j(value).attr('data')
    css_link = $("<link>",
      rel: "stylesheet"
      type: "text/css"
      href: prefix+host+'<%= stylesheet_path("widget.css", only_path: false) %>'
    )
    css_link.appendTo "head"
    jsonp_url= prefix+host+'<%= widgets_path() %>'+'/'+data_id
    console.log(jsonp_url)
    $j.ajax
      url: jsonp_url
      success: (data) ->
        $j(value).append data